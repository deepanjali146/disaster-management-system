{% extends "base.html" %}
{% block title %}Scan to Pay - UPI{% endblock %}

{% block content %}
<div class="container text-center mt-5">
    <h3>Scan to Pay</h3>
    <p>Amount: â‚¹{{ amount }}</p>
    <div class="my-3">
        {% if qr_base64 %}
        <img src="data:image/png;base64,{{ qr_base64 }}" alt="UPI QR" class="img-fluid" style="max-width: 300px; border: 2px solid #ddd; border-radius: 10px;">
        {% else %}
        <img src="data:image/png;base64,{{ upi_qr.qr_code }}" alt="UPI QR" class="img-fluid" style="max-width: 300px; border: 2px solid #ddd; border-radius: 10px;">
        {% endif %}
    </div>
    <p class="text-muted">Open your UPI app and scan to pay</p>

    <div id="checking" class="mt-3 text-info">Waiting for payment confirmation...</div>

    <form action="{{ url_for('donate_confirm') }}" method="post" class="mt-3">
        <button type="submit" class="btn btn-success">
            <i class="fas fa-check me-2"></i>I have paid
        </button>
    </form>
</div>

<script>
async function checkPayment() {
    try {
        const txId = {{ upi_qr.transaction_id if upi_qr and upi_qr.transaction_id else 'null' }};
        if (!txId) return;
        const response = await fetch(`/donate/status/${txId}`);
        const result = await response.json();
        if (result && result.is_success) {
            window.location.href = "{{ url_for('donate_success') }}";
        }
    } catch (err) {
        console.error("Status check error:", err);
    }
}

// Poll every 5 seconds
setInterval(checkPayment, 5000);
</script>
{% endblock %}

 
